<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé™ Circus Wheel Spinner</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;700&family=Limelight&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            overflow: hidden;
            width: 100%;
            height: 100%;
        }

        @keyframes rotateBackground {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .page-title {
            font-family: 'Limelight', cursive;
            font-size: 48px;
            color: #d64545;
            text-align: center;
            margin: 0;
            padding: 20px 0;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 10;
            text-shadow: 0 0 8px rgba(0, 0, 0, 0.3);
            pointer-events: none;
            text-transform: uppercase;
            -webkit-text-stroke: 4px #ffffff;
            paint-order: stroke fill;
        }

        body {
            font-family: 'Lexend', sans-serif;
            background: #f4e8d0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            position: relative;
            --bg-left: 50%;
            --bg-top: 50%;
            --title-height: 88px;
        }

        body::before {
            content: '';
            position: fixed;
            left: var(--bg-left);
            top: var(--bg-top);
            width: 300vmax;
            height: 300vmax;
            background: repeating-conic-gradient(
                from 0deg,
                #d64545 0deg 6deg,
                #f4e8d0 6deg 12deg,
                #4a8f8f 12deg 18deg,
                #f4e8d0 18deg 24deg,
                #d64545 24deg 30deg,
                #f4e8d0 30deg 36deg,
                #4a8f8f 36deg 42deg,
                #f4e8d0 42deg 48deg
            );
            animation: rotateBackground 200s linear infinite;
            z-index: 0;
            pointer-events: none;
            transform-origin: center center;
            transition: left 0.3s ease, top 0.3s ease;
            filter: blur(5px);
        }
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at center, rgba(0, 0, 0, 0.6) 0%, transparent 70%),
                radial-gradient(circle at 20% 30%, rgba(244, 232, 208, 0.3) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(244, 232, 208, 0.3) 0%, transparent 40%);
            z-index: 1;
            pointer-events: none;
        }

        .container {
            display: flex;
            width: 100%;
            align-items: stretch;
            position: relative;
            z-index: 2;
            height: 100%;
            padding: 20px;
            justify-content: space-between;
        }

        .wheel-section {
            flex: 0 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: fixed;
            top: calc(50% + var(--title-height) / 2);
            left: 50%;
            transform: translate(-50%, calc(-50% - 35px));
            pointer-events: none;
        }

        .wheel-container {
            position: relative;
            width: 500px;
            height: 500px;
            transition: transform 0.3s ease;
            pointer-events: auto;
        }

        .wheel-decoration {
            position: absolute;
            width: 540px;
            height: 540px;
            left: -20px;
            top: -20px;
            border: 10px solid #d4a574;
            border-radius: 50%;
            box-shadow: 0 0 30px rgba(212, 165, 116, 0.5),
                        inset 0 0 30px rgba(212, 165, 116, 0.3);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 30px rgba(212, 165, 116, 0.5), inset 0 0 30px rgba(212, 165, 116, 0.3); }
            to { box-shadow: 0 0 50px rgba(212, 165, 116, 0.8), inset 0 0 50px rgba(212, 165, 116, 0.5); }
        }

        .wheel {
            width: 500px;
            height: 500px;
            border-radius: 50%;
            position: relative;
            transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1);
            cursor: pointer;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
            border: 8px solid #fff;
        }

        .wheel.spinning {
            transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
        }

        .wheel-center {
            position: absolute;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #d4a574, #b8885d);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            border: 5px solid #8b6f47;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            cursor: pointer;
        }

        .pointer {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 25px solid transparent;
            border-right: 25px solid transparent;
            border-top: 50px solid #d64545;
            z-index: 11;
            filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.3));
        }

        .pointer::after {
            content: '';
            position: absolute;
            top: -50px;
            left: -25px;
            width: 50px;
            height: 50px;
            background: #d64545;
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
        }

        .panel {
            background: rgba(244, 232, 208, 0.95);
            border-radius: 20px;
            padding: 25px;
            width: 350px;
            min-width: 350px;
            max-width: 350px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
            border: 5px solid #d4a574;
            transition: all 0.3s ease;
            position: relative;
            z-index: 2;
            align-self: stretch;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        @media (max-width: 1300px) {
            .panel {
                position: fixed;
                top: 20px;
                bottom: 20px;
                height: auto;
                z-index: 100;
            }

            .left-panel {
                left: 20px;
            }

            #panel {
                right: 20px;
            }

            .panel.collapsed {
                position: fixed;
                z-index: 100;
            }

            .left-panel.collapsed {
                left: 20px;
                top: 20px;
            }

            #panel.collapsed {
                right: 20px;
                top: 20px;
            }

            .container {
                justify-content: center;
            }
        }

        .panel.collapsed {
            width: 70px;
            height: 70px;
            padding: 0;
            overflow: visible;
            min-width: 70px;
            flex-shrink: 0;
            align-self: flex-start;
            margin-top: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 50%;
        }

        .panel.collapsed .toggle-btn {
            display: none;
        }

        .panel.collapsed::after {
            content: 'üé®';
            font-size: 32px;
            position: absolute;
        }

        .left-panel.collapsed::after {
            content: 'üéä';
        }

        .left-panel {
            order: -1;
        }

        .left-panel .panel-header {
            flex-direction: row-reverse;
        }

        .left-panel.collapsed .toggle-btn {
            transform: none;
        }

        /* Right panel mirrored - button on left, title on right */
        #panel .panel-header {
            flex-direction: row;
        }

        #panel .panel-header h2 {
            text-align: right;
            order: 2;
        }

        #panel .panel-header .toggle-btn {
            order: 1;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .panel-header h2 {
            color: #d64545;
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            font-family: 'Limelight', cursive;
        }

        .toggle-btn {
            background: #d64545;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            flex-shrink: 0;
            min-width: 35px;
            min-height: 35px;
        }

        .toggle-btn:hover {
            background: #b83838;
            transform: scale(1.1);
        }

        .panel-content {
            transition: opacity 0.3s ease;
            flex: 1;
            overflow-y: auto;
            min-height: 0;
            margin-right: -15px;
            padding-right: 15px;
        }

        /* Custom scrollbar styling */
        .panel-content::-webkit-scrollbar {
            width: 10px;
        }

        .panel-content::-webkit-scrollbar-track {
            background: rgba(212, 165, 116, 0.2);
            border-radius: 10px;
        }

        .panel-content::-webkit-scrollbar-thumb {
            background: #d4a574;
            border-radius: 10px;
            border: 2px solid rgba(244, 232, 208, 0.95);
        }

        .panel-content::-webkit-scrollbar-thumb:hover {
            background: #b8885d;
        }

        /* Firefox scrollbar styling */
        .panel-content {
            scrollbar-width: thin;
            scrollbar-color: #d4a574 rgba(212, 165, 116, 0.2);
        }

        .panel.collapsed .panel-content {
            display: none;
        }

        .panel.collapsed h2 {
            display: none;
        }

        .options-list {
            margin-bottom: 15px;
        }

        .option-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: flex-start;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.5);
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #d4a574;
            transition: all 0.3s ease;
            position: relative;
        }

        .option-item.inactive {
            background: rgba(150, 150, 150, 0.3);
            opacity: 0.6;
        }

        .option-item-row {
            display: flex;
            gap: 10px;
            width: 100%;
            align-items: center;
        }

        .option-item input[type="text"],
        .option-item textarea {
            flex: 1;
            padding: 8px;
            border: 2px solid #d64545;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            font-family: inherit;
        }

        .option-item.inactive input[type="text"],
        .option-item.inactive textarea {
            background: #f0f0f0;
        }

        .option-item textarea {
            width: 100%;
            min-height: 50px;
            resize: vertical;
            margin-top: 5px;
        }

        .option-item input[type="color"] {
            width: 40px;
            height: 40px;
            border: 2px solid #d64545;
            border-radius: 8px;
            cursor: pointer;
        }

        .delete-btn {
            background: #d64545;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            padding: 0;
        }

        .delete-btn:hover {
            background: #b83838;
            transform: scale(1.1);
        }

        .delete-btn-circle {
            background: #d64545;
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            padding: 0;
            position: absolute;
            top: 8px;
            right: 8px;
        }

        .delete-btn-circle:hover {
            background: #b83838;
            transform: scale(1.1);
        }

        .restore-btn {
            background: #4a8f8f;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .restore-btn:hover {
            background: #3a7373;
        }

        .btn {
            background: #d64545;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .btn:hover {
            background: #b83838;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        .textarea-input {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 2px solid #d64545;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            margin-bottom: 10px;
            resize: vertical;
            background: white;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: #f4e8d0;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            border: 5px solid #d4a574;
            animation: modalPop 0.5s ease;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
        }

        @keyframes modalPop {
            0% { transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .modal-content h2 {
            color: #d64545;
            font-size: 32px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .modal-content .result {
            font-size: 28px;
            font-weight: bold;
            margin: 20px 0;
            padding: 20px;
            background: white;
            color: #333;
            border-radius: 15px;
            border: 3px solid #d4a574;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .modal-content .description {
            font-size: 16px;
            margin: 15px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            color: #555;
            font-style: italic;
            border: 2px solid #d4a574;
        }

        .close-modal-btn {
            background: #d64545;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .close-modal-btn:hover {
            background: #b83838;
        }

        .history-header {
            margin-bottom: 15px;
        }

        .history-header h3 {
            color: #d64545;
            font-size: 20px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            font-family: 'Limelight', cursive;
        }

        .history-toggle {
            background: #4a8f8f;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .history-toggle:hover {
            background: #3a7373;
        }

        .history-list {
            overflow-y: visible;
        }

        .history-list.show {
            display: block;
        }

        .history-item {
            padding: 12px;
            margin-bottom: 8px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #d64545;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .history-item:hover {
            transform: translateX(5px);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
        }

        .history-item-text {
            font-weight: bold;
            color: #333;
            margin-bottom: 3px;
        }

        .history-item-time {
            font-size: 12px;
            color: #666;
        }

        .confetti {
            position: fixed;
            width: 15px;
            height: 15px;
            pointer-events: none;
            z-index: 999;
            border-radius: 3px;
        }

        @keyframes confettiExplode {
            0% {
                transform: translate(0, 0) rotate(0deg) scale(1);
                opacity: 1;
            }
            100% {
                /* Ease-out to 0 velocity - no gravity, just deceleration */
                transform: translate(var(--end-x), var(--end-y)) rotate(720deg) scale(0.5);
                opacity: 0;
            }
        }

        .spin-instruction {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 20px;
            color: #d64545;
            font-weight: bold;
            border: 3px solid #d4a574;
            animation: pulse 2s ease-in-out infinite;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            position: absolute;
            z-index: 2;
            top: 100%;
            left: 50%;
            margin-top: 20px;
            white-space: nowrap;
            transform: translateX(-50%) translateY(0);
            font-family: 'Limelight', cursive;
            pointer-events: auto;
        }

        @keyframes pulse {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.05); }
        }

        .label-text {
            font-size: 12px;
            color: #666;
            margin-bottom: 3px;
            font-weight: bold;
        }

        /* Range slider styling */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: linear-gradient(to right, #d4a574 0%, #d64545 100%);
            border-radius: 5px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #d64545;
            border: 3px solid #d4a574;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            background: #b83838;
            transform: scale(1.1);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #d64545;
            border: 3px solid #d4a574;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        input[type="range"]::-moz-range-thumb:hover {
            background: #b83838;
        }
    </style>
</head>
<body>
    <h1 class="page-title" id="pageTitle">Punishment Wheel</h1>

    <div class="container">
        <div class="panel left-panel" id="historyPanel" onclick="if(this.classList.contains('collapsed')) toggleHistoryPanel()">
            <div class="panel-header">
                <button class="toggle-btn" onclick="event.stopPropagation(); toggleHistoryPanel()">‚óÄ</button>
                <h2>üéä History</h2>
            </div>
            <div class="panel-content">
                <button class="history-toggle" onclick="clearHistory()" style="background: #d64545; width: 100%; margin-bottom: 15px;">Clear All</button>
                <div class="history-list show" id="historyList"></div>
            </div>
        </div>

        <div class="wheel-section">
            <div class="wheel-container">
                <div class="wheel-decoration"></div>
                <div class="pointer"></div>
                <canvas id="wheelCanvas" width="500" height="500" class="wheel"></canvas>
                <div class="wheel-center">üé™</div>
                <div class="spin-instruction">üéØ Click the wheel to spin! üéØ</div>
            </div>
        </div>

        <div class="panel" id="panel" onclick="if(this.classList.contains('collapsed')) togglePanel()">
            <div class="panel-header">
                <h2>Options üé®</h2>
                <button class="toggle-btn" onclick="event.stopPropagation(); togglePanel()">‚ñ∂</button>
            </div>
            <div class="panel-content">
                <div style="background: rgba(255, 255, 255, 0.7); padding: 12px; border-radius: 10px; margin-bottom: 15px; border: 2px solid #d4a574;" id="toggleContainer">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; color: #333; font-weight: bold;">
                        <input type="checkbox" id="removeWinnerToggle" onchange="updateToggleStyle()" style="width: 20px; height: 20px; cursor: pointer;">
                        <span>üóëÔ∏è Remove winner after spin</span>
                    </label>
                </div>
                <div class="options-list" id="optionsList"></div>
                <button class="btn" onclick="addOption()">‚ûï Add Option</button>
                <button class="btn" onclick="refreshWheel()" style="background: #8b6f47;">üîÑ Refresh Wheel</button>
                
                <hr style="margin: 20px 0; border: 1px solid #ddd;">
                
                <h3 style="color: #d64545; margin-bottom: 10px; font-family: 'Limelight', cursive;">üìù Title</h3>
                <input type="text" id="titleInput" value="Prize Wheel" 
                       oninput="updateTitle(this.value)" 
                       style="width: 100%; padding: 10px; border: 2px solid #d64545; border-radius: 8px; font-size: 16px; margin-bottom: 10px;">
                
                <hr style="margin: 20px 0; border: 1px solid #ddd;">
                
                <h3 style="color: #d64545; margin-bottom: 10px; font-family: 'Limelight', cursive;">üéØ Wheel Scale</h3>
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                    <input type="range" id="wheelScale" min="0.5" max="1.5" step="0.05" value="1.3" 
                           style="flex: 1; cursor: pointer;" oninput="updateWheelScale(this.value)">
                    <span id="scaleValue" style="font-weight: bold; color: #d64545; min-width: 45px;">100%</span>
                </div>
                
                <hr style="margin: 20px 0; border: 1px solid #ddd;">
                
                <h3 style="color: #d64545; margin-bottom: 10px; font-family: 'Limelight', cursive;">üìã Bulk Import</h3>
                <textarea class="textarea-input" id="bulkInput" placeholder="Paste options here (one per line):
Display Text|#HEX|Description
Prize 1|#d64545|A wonderful first prize!
Prize 2|#4a8f8f|An amazing second prize!"></textarea>
                <button class="btn" onclick="importOptions()">üì• Import</button>
                
                <button class="btn" onclick="copyOptions()" style="background: #4a8f8f;">üìÑ Copy All Options</button>
                
                <hr style="margin: 20px 0; border: 1px solid #ddd;">
                
                <h3 style="color: #d64545; margin-bottom: 10px; font-family: 'Limelight', cursive;">üé™ Other Wheels</h3>
                <a href="../prizewheel/" class="btn" style="display: block; text-align: center; text-decoration: none; margin-bottom: 10px;">üéÅ Prize Wheel</a>
                <a href="../challengewheel/" class="btn" style="display: block; text-align: center; text-decoration: none;">üèÜ Challenge Wheel</a>
                <a href="../oddsorevens/" class="btn" style="display: block; text-align: center; text-decoration: none;">‚ùì Try your luck</a>
            </div>
        </div>
    </div>

    <div class="modal" id="resultModal">
        <div class="modal-content">
            <h2>üéâ Winner! üéâ</h2>
            <div class="result" id="resultText"></div>
            <div class="description" id="resultDescription"></div>
            <button class="close-modal-btn" onclick="closeModal()">Close</button>
        </div>
    </div>
<!-- ================================================= OPTIONS========================================================================== -->
    <script>
        let options = [
            { text: 'Grand Prize', description: 'The ultimate reward - a spectacular grand prize!', color: '#d64545', disabled: false },
            { text: 'Mystery Box', description: 'What could be inside? Open to find out!', color: '#4a8f8f', disabled: false },
            { text: 'Golden Ticket', description: 'A rare and valuable golden ticket!', color: '#d4a574', disabled: false },
            { text: 'Bonus Round', description: 'Spin again for another chance to win!', color: '#f4e8d0', disabled: false },
            { text: 'Special Prize', description: 'A unique and special reward awaits!', color: '#8b6f47', disabled: false },
            { text: 'Jackpot', description: 'Hit the jackpot and win big!', color: '#b83838', disabled: false }
        ];

        let isSpinning = false;
        let history = [];
        let currentWinner = null; // Store the current winner for delayed removal
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        let currentRotation = 0;
        
        // Audio context for tick sounds
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioContext = new AudioContext();
        
        function playTick() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'square';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.1);
        }

        function drawWheel() {
            ctx.save();
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const enabledOptions = options.filter(o => !o.disabled);
            
            if (enabledOptions.length === 0) {
                ctx.fillStyle = '#f4e8d0';
                ctx.beginPath();
                ctx.arc(250, 250, 242, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#d64545';
                ctx.font = 'bold 20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('No active options!', 250, 240);
                ctx.font = '16px Arial';
                ctx.fillText('Add options or refresh wheel', 250, 265);
                ctx.restore();
                return;
            }

            ctx.translate(250, 250);
            ctx.rotate(currentRotation);
            ctx.translate(-250, -250);

            const arc = (Math.PI * 2) / enabledOptions.length;
            
            enabledOptions.forEach((option, index) => {
                const angle = index * arc;
                
                // Draw segment
                ctx.beginPath();
                ctx.fillStyle = option.color;
                ctx.moveTo(250, 250);
                ctx.arc(250, 250, 242, angle, angle + arc);
                ctx.lineTo(250, 250);
                ctx.fill();
                
                // Segment border
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 3;
                ctx.stroke();
                
                // Draw text
                ctx.save();
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 16px Lexend, Arial, sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                // Add soft shadow for text (no offset - creates glow effect)
                ctx.shadowColor = 'rgba(0, 0, 0, 0.8)';
                ctx.shadowBlur = 4;
                ctx.shadowOffsetX = 0;
                ctx.shadowOffsetY = 0;
                
                const textAngle = angle + arc / 2;
                const textRadius = 160;
                const x = 250 + Math.cos(textAngle) * textRadius;
                const y = 250 + Math.sin(textAngle) * textRadius;
                
                ctx.translate(x, y);
                ctx.rotate(textAngle + Math.PI / 2);
                
                // Wrap text to multiple lines
                const maxWidth = 140; // Maximum width for text
                const words = option.text.split(' ');
                const lines = [];
                let currentLine = words[0];
                
                for (let i = 1; i < words.length; i++) {
                    const testLine = currentLine + ' ' + words[i];
                    const metrics = ctx.measureText(testLine);
                    if (metrics.width > maxWidth) {
                        lines.push(currentLine);
                        currentLine = words[i];
                    } else {
                        currentLine = testLine;
                    }
                }
                lines.push(currentLine);
                
                // Draw each line with appropriate spacing
                const lineHeight = 18;
                const totalHeight = lines.length * lineHeight;
                const startY = -(totalHeight / 2) + (lineHeight / 2);
                
                lines.forEach((line, i) => {
                    const yPos = startY + (i * lineHeight);
                    ctx.fillText(line, 0, yPos);
                });
                
                ctx.restore();
                
                // Draw pin/circle
                const pinAngle = angle + arc / 2;
                const pinRadius = 220;
                const pinX = 250 + Math.cos(pinAngle) * pinRadius;
                const pinY = 250 + Math.sin(pinAngle) * pinRadius;
                
                ctx.beginPath();
                ctx.arc(pinX, pinY, 8, 0, Math.PI * 2);
                ctx.fillStyle = '#8b6f47';
                ctx.fill();
                ctx.strokeStyle = '#d4a574';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Inner circle on pin
                ctx.beginPath();
                ctx.arc(pinX, pinY, 4, 0, Math.PI * 2);
                ctx.fillStyle = '#d4a574';
                ctx.fill();
            });
            
            ctx.restore();
        }

        function renderOptions() {
            const list = document.getElementById('optionsList');
            list.innerHTML = '';
            
            options.forEach((option, index) => {
                const div = document.createElement('div');
                div.className = 'option-item' + (option.disabled ? ' inactive' : '');
                
                const restoreButton = option.disabled ? `<button class="restore-btn" onclick="restoreOption(${index})">‚Ü©Ô∏è Restore</button>` : '';
                const statusLabel = option.disabled ? '<div style="color: #888; font-size: 11px; font-weight: bold;">REMOVED FROM WHEEL</div>' : '';
                
                div.innerHTML = `
                    <button class="delete-btn-circle" onclick="deleteOption(${index})">√ó</button>
                    ${statusLabel}
                    <div class="label-text">Display Text:</div>
                    <div class="option-item-row">
                        <input type="text" value="${option.text}" onchange="updateOption(${index}, this.value, null, null)" ${option.disabled ? 'disabled' : ''}>
                        <input type="color" value="${option.color}" onchange="updateOption(${index}, null, this.value, null)" ${option.disabled ? 'disabled' : ''}>
                        ${restoreButton}
                    </div>
                    <div class="label-text">Description:</div>
                    <textarea onchange="updateOption(${index}, null, null, this.value)" ${option.disabled ? 'disabled' : ''}>${option.description || ''}</textarea>
                `;
                list.appendChild(div);
            });
            
            drawWheel();
        }

        function addOption() {
            options.push({ 
                text: `Prize ${options.length + 1}`,
                description: 'Enter a description for this prize...',
                color: '#' + Math.floor(Math.random()*16777215).toString(16),
                disabled: false
            });
            renderOptions();
        }

        function restoreOption(index) {
            options[index].disabled = false;
            renderOptions();
        }

        function refreshWheel() {
            options.forEach(option => option.disabled = false);
            renderOptions();
        }

        function updateToggleStyle() {
            const toggle = document.getElementById('removeWinnerToggle');
            const container = document.getElementById('toggleContainer');
            
            if (toggle.checked) {
                container.style.background = 'rgba(214, 69, 69, 0.2)';
                container.style.borderColor = '#d64545';
                container.style.borderWidth = '3px';
            } else {
                container.style.background = 'rgba(255, 255, 255, 0.7)';
                container.style.borderColor = '#d4a574';
                container.style.borderWidth = '2px';
            }
        }

        function updateWheelScale(value) {
            const wheelContainer = document.querySelector('.wheel-container');
            const wheelSection = document.querySelector('.wheel-section');
            const scaleDisplay = document.getElementById('scaleValue');
            const canvas = document.getElementById('wheelCanvas');
            
            // Update scale
            wheelContainer.style.transform = `scale(${value})`;
            
            // Update canvas resolution for crisp rendering at any scale
            // Use device pixel ratio and scale factor for high quality
            const dpr = window.devicePixelRatio || 1;
            const scaleFactor = value * dpr;
            
            canvas.width = 500 * scaleFactor;
            canvas.height = 500 * scaleFactor;
            
            // Scale context to match
            ctx.scale(scaleFactor, scaleFactor);
            
            // Redraw with new resolution
            drawWheel();
            
            // Update display percentage
            scaleDisplay.textContent = Math.round(value * 100) + '%';
            
            // Update background position after scale change
            setTimeout(updateBackgroundPosition, 50);
        }

        function updateTitle(value) {
            document.getElementById('pageTitle').textContent = value || 'Punishment Wheel';
        }

        function updateOption(index, text, color, description) {
            if (text !== null) options[index].text = text;
            if (color !== null) options[index].color = color;
            if (description !== null) options[index].description = description;
            drawWheel();
        }

        function deleteOption(index) {
            options.splice(index, 1);
            renderOptions();
        }

        function togglePanel() {
            const panel = document.getElementById('panel');
            const historyPanel = document.getElementById('historyPanel');
            const isCurrentlyCollapsed = panel.classList.contains('collapsed');
            
            // Calculate if panels would overlap: 2 panels (350px each) + wheel (500px) + gaps (60px margins) + padding (40px) = 1300px
            // But panels overlay at 1300px, so they only truly overlap when screen is narrower than both panels combined
            const panelsWouldOverlap = window.innerWidth < 800; // 2 * 350px + some margin
            
            // On very narrow screens where panels overlap, collapse the other panel when opening this one
            if (isCurrentlyCollapsed && panelsWouldOverlap) {
                if (!historyPanel.classList.contains('collapsed')) {
                    historyPanel.classList.add('collapsed');
                }
            }
            
            panel.classList.toggle('collapsed');
            const btn = panel.querySelector('.toggle-btn');
            btn.textContent = panel.classList.contains('collapsed') ? '‚óÄ' : '‚ñ∂';
            setTimeout(updateBackgroundPosition, 350);
        }

        function copyOptions() {
            const text = options.map(o => {
                const desc = o.description || '';
                return `${o.text}|${o.color}|${desc}`;
            }).join('\n');
            
            // Fallback method using textarea
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.left = '-9999px';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    alert('‚úÖ Options copied to clipboard!');
                } else {
                    alert('‚ùå Failed to copy. Please try manually selecting the text.');
                }
            } catch (err) {
                console.error('Failed to copy:', err);
                alert('‚ùå Failed to copy. Please try manually selecting the text.');
            } finally {
                document.body.removeChild(textarea);
            }
        }

        function importOptions() {
            const input = document.getElementById('bulkInput').value.trim();
            if (!input) return;
            
            const lines = input.split('\n');
            const newOptions = [];
            
            lines.forEach(line => {
                const parts = line.split('|');
                if (parts.length >= 1 && parts[0].trim()) {
                    newOptions.push({
                        text: parts[0].trim(),
                        color: parts.length >= 2 && parts[1].trim() ? parts[1].trim() : '#' + Math.floor(Math.random()*16777215).toString(16),
                        description: parts.length >= 3 ? parts[2].trim() : '',
                        disabled: false
                    });
                }
            });
            
            if (newOptions.length > 0) {
                options = newOptions;
                renderOptions();
                document.getElementById('bulkInput').value = '';
            }
        }

        function spinWheel() {
            const enabledOptions = options.filter(o => !o.disabled);
            if (isSpinning || enabledOptions.length === 0) return;
            
            // Resume audio context on user interaction
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            
            isSpinning = true;
            canvas.style.pointerEvents = 'none';
            
            const spins = 5 + Math.random() * 3;
            const randomAngle = Math.random() * Math.PI * 2;
            const targetRotation = currentRotation + (spins * Math.PI * 2) + randomAngle;
            
            const startTime = Date.now();
            const duration = 4000;
            const startRotation = currentRotation;
            
            let lastPinIndex = -1;
            
            function animate() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Easing function for deceleration
                const eased = 1 - Math.pow(1 - progress, 3);
                currentRotation = startRotation + (targetRotation - startRotation) * eased;
                
                drawWheel();
                
                // Check for pin passing
                const enabledOptions = options.filter(o => !o.disabled);
                const arc = (Math.PI * 2) / enabledOptions.length;
                const normalizedRotation = (currentRotation % (Math.PI * 2) + Math.PI * 2) % (Math.PI * 2);
                const currentPinIndex = Math.floor(normalizedRotation / arc);
                
                if (currentPinIndex !== lastPinIndex && progress < 0.95) {
                    playTick();
                    lastPinIndex = currentPinIndex;
                }
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    // Get enabled options for winner calculation
                    const enabledOptions = options.filter(o => !o.disabled);
                    
                    // Determine winner - the segment at the top (where the pointer is)
                    const arc = (Math.PI * 2) / enabledOptions.length;
                    
                    // Normalize the rotation to 0-2œÄ
                    let normalizedRotation = currentRotation % (Math.PI * 2);
                    if (normalizedRotation < 0) normalizedRotation += Math.PI * 2;
                    
                    // The pointer is at the top (270¬∞ or 3œÄ/2 in our coordinate system)
                    const pointerAngle = Math.PI * 1.5; // Top of wheel (270¬∞)
                    
                    // Find which segment's range includes the pointer position
                    let angleAtPointer = (pointerAngle - normalizedRotation) % (Math.PI * 2);
                    if (angleAtPointer < 0) angleAtPointer += Math.PI * 2;
                    
                    // Find which segment this angle falls into
                    const selectedIndex = Math.floor(angleAtPointer / arc) % enabledOptions.length;
                    const winner = enabledOptions[selectedIndex];
                    
                    // Store winner for potential removal when modal closes
                    currentWinner = winner;
                    
                    showResult(winner);
                    createConfetti();
                    addToHistory(winner);
                    
                    isSpinning = false;
                    canvas.style.pointerEvents = 'auto';
                }
            }
            
            animate();
        }

        function showResult(winner) {
            document.getElementById('resultText').textContent = winner.text;
            document.getElementById('resultText').style.borderColor = winner.color;
            const descriptionEl = document.getElementById('resultDescription');
            if (winner.description) {
                descriptionEl.textContent = winner.description;
                descriptionEl.style.display = 'block';
            } else {
                descriptionEl.style.display = 'none';
            }
            document.getElementById('resultModal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('resultModal').classList.remove('show');
            
            // Check if we should remove the winner now that modal is closed
            const removeWinnerToggle = document.getElementById('removeWinnerToggle');
            
            if (removeWinnerToggle && removeWinnerToggle.checked && currentWinner) {
                // Find the winner in the full options array and mark as disabled
                const fullIndex = options.findIndex(opt => 
                    opt.text === currentWinner.text && 
                    opt.color === currentWinner.color && 
                    opt.description === currentWinner.description
                );
                
                if (fullIndex !== -1) {
                    options[fullIndex].disabled = true;
                    
                    // Re-render the options list
                    renderOptions();
                }
            }
            
            // Clear current winner
            currentWinner = null;
        }

        function createConfetti() {
            const colors = [
                '#d64545', '#4a8f8f', '#d4a574', '#f4e8d0', '#8b6f47', '#b83838',
                '#ff6b9d', '#ffd93d', '#6bcf7f', '#4d96ff', '#c44dff', '#ff5722',
                '#00bcd4', '#ffeb3b', '#e91e63', '#9c27b0', '#ff9800', '#4caf50'
            ];
            
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    
                    // Start from center of screen
                    const centerX = window.innerWidth / 2;
                    const centerY = window.innerHeight / 2;
                    
                    // Random angle in all directions (0 to 360 degrees)
                    const angle = Math.random() * Math.PI * 2;
                    const velocity = 1100; // Fixed velocity in all directions
                    
                    // Calculate end positions
                    const endX = Math.cos(angle) * velocity;
                    const endY = Math.sin(angle) * velocity;
                    
                    confetti.style.left = centerX + 'px';
                    confetti.style.top = centerY + 'px';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    
                    // Set CSS custom properties for animation
                    confetti.style.setProperty('--end-x', endX + 'px');
                    confetti.style.setProperty('--end-y', endY + 'px');
                    
                    // Ease-out animation - starts fast at 1100px, gradually slows to 0
                    confetti.style.animation = `confettiExplode ${1.5 + Math.random() * 1}s ease-out forwards`;
                    confetti.style.animationDelay = Math.random() * 0.1 + 's';
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 4000);
                }, i * 8);
            }
        }

        function addToHistory(winner) {
            const time = new Date().toLocaleTimeString();
            history.unshift({ text: winner.text, color: winner.color, description: winner.description, time });
            updateHistoryDisplay();
        }

        function updateHistoryDisplay() {
            const list = document.getElementById('historyList');
            list.innerHTML = history.map((item, index) => `
                <div class="history-item" style="border-left-color: ${item.color}" onclick="showHistoryItem(${index})">
                    <div class="history-item-text">${item.text}</div>
                    <div class="history-item-time">${item.time}</div>
                </div>
            `).join('');
        }

        function showHistoryItem(index) {
            const item = history[index];
            showResult(item);
        }

        function toggleHistoryPanel() {
            const panel = document.getElementById('panel');
            const historyPanel = document.getElementById('historyPanel');
            const isCurrentlyCollapsed = historyPanel.classList.contains('collapsed');
            
            // Calculate if panels would overlap
            const panelsWouldOverlap = window.innerWidth < 800; // 2 * 350px + some margin
            
            // On very narrow screens where panels overlap, collapse the other panel when opening this one
            if (isCurrentlyCollapsed && panelsWouldOverlap) {
                if (!panel.classList.contains('collapsed')) {
                    panel.classList.add('collapsed');
                }
            }
            
            historyPanel.classList.toggle('collapsed');
            const btn = historyPanel.querySelector('.toggle-btn');
            btn.textContent = historyPanel.classList.contains('collapsed') ? '‚ñ∂' : '‚óÄ';
            setTimeout(updateBackgroundPosition, 350);
        }

        function clearHistory() {
            history = [];
            updateHistoryDisplay();
        }

        canvas.addEventListener('click', spinWheel);
        document.querySelector('.wheel-center').addEventListener('click', spinWheel);

        // Function to center background on wheel
        function updateBackgroundPosition() {
            const wheelContainer = document.querySelector('.wheel-container');
            const rect = wheelContainer.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            document.documentElement.style.setProperty('--bg-left', centerX + 'px');
            document.documentElement.style.setProperty('--bg-top', centerY + 'px');
        }

        // Update background position on load and resize
        window.addEventListener('load', updateBackgroundPosition);
        window.addEventListener('resize', updateBackgroundPosition);
        
        // Handle window resize to prioritize options panel on narrow screens
        window.addEventListener('resize', () => {
            const panel = document.getElementById('panel');
            const historyPanel = document.getElementById('historyPanel');
            
            // If panels would overlap and both panels are open, collapse history panel
            const panelsWouldOverlap = window.innerWidth < 800;
            if (panelsWouldOverlap) {
                if (!panel.classList.contains('collapsed') && !historyPanel.classList.contains('collapsed')) {
                    historyPanel.classList.add('collapsed');
                }
            }
        });
        
        // Call immediately
        updateBackgroundPosition();

        // Initialize canvas with high resolution
        const dpr = window.devicePixelRatio || 1;
        canvas.width = 500 * dpr;
        canvas.height = 500 * dpr;
        ctx.scale(dpr, dpr);

        renderOptions();
    </script>
</body>
</html>
